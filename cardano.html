<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cardano Cold Wallet</title>
    <link rel="stylesheet" href="css/style2.css">
    <script src="js/qrcode.js"></script>
    <script src="js/cardano-wordlist.js"></script>
    <script type="module">
      import init, * as CardanoWasm from "./js/cardano_serialization_lib.js";
      await init("./js/cardano_serialization_lib_bg.wasm");
      // Prototype chain correction (required in some versions)
      if (CardanoWasm.Credential && CardanoWasm.StakeCredential)
        Object.setPrototypeOf(CardanoWasm.StakeCredential.prototype, CardanoWasm.Credential.prototype);

      window.generate = function() {
        const pubElem = document.getElementById("public");
        const seedElem = document.getElementById("secret");
        const pubQRElem = document.getElementById("public_qr");
        const seedQRElem = document.getElementById("secret_qr");
        try {
          const mnemonic = window.bip39.generateMnemonic(256);
          const entropyBytes = window.bip39.mnemonicToEntropy(mnemonic);
          const rootKey = CardanoWasm.Bip32PrivateKey.from_bip39_entropy(
            entropyBytes,
            new Uint8Array()
          );
          const HARDENED = 0x80000000;
          const accountKey = rootKey
            .derive(HARDENED + 1852)
            .derive(HARDENED + 1815)
            .derive(HARDENED + 0);
          const paymentKey = accountKey.derive(0).derive(0);
          const stakeKey = accountKey.derive(2).derive(0);
          const paymentPub = paymentKey.to_public();
          const paymentKeyHash = paymentPub.to_raw_key().hash();
          const stakePub = stakeKey.to_public();
          const stakeKeyHash = stakePub.to_raw_key().hash();
          const paymentCred = CardanoWasm.StakeCredential.fromKeyhash(paymentKeyHash);
          const stakeCred = CardanoWasm.StakeCredential.fromKeyhash(stakeKeyHash);
          const networkId = 1;
          const baseAddr = CardanoWasm.BaseAddress.new(networkId, paymentCred, stakeCred);
          const address = baseAddr.to_address().to_bech32();
          pubElem.textContent = address;
          seedElem.textContent = mnemonic;
          pubQRElem.innerHTML = "";
          seedQRElem.innerHTML = "";
          new QRCode(pubQRElem, {
            text: address,
            width: 100,
            height: 100,
            colorDark: "#e0e0e0",
            colorLight: "#1e1e1e",
            correctLevel: QRCode.CorrectLevel.H
          });
          new QRCode(seedQRElem, {
            text: mnemonic,
            width: 100,
            height: 100,
            colorDark: "#e0e0e0",
            colorLight: "#1e1e1e",
            correctLevel: QRCode.CorrectLevel.H
          });
        } catch (e) {
          pubElem.textContent = "Error: " + e;
          seedElem.textContent = "";
          pubQRElem.innerHTML = "";
          seedQRElem.innerHTML = "";
        }
      };
         // global access for buttons
      window.generate = generate;
      // auto generate after loading:
      generate();
    </script>
</head>
<body onload="generate()">
    <div class="container">
        <h1>Cardano Cold Wallet</h1>
        <div class="button-group">
            <button onclick="window.location.href='index.html'">Home</button>
            <button onclick="generate()">Generate</button>
            <button onclick="window.print()">Print</button>
        </div>
        <div class="info-box">
            <label>Public Address (SHARE)</label>
            <span id="public">Click Generate to create wallet</span>
            <div id="public_qr" class="qr-code"></div>
        </div>
        <div class="info-box">
            <label>Mnemonic Seed (SECRET)</label>
            <span id="secret">Click Generate to create wallet</span>
            <div id="secret_qr" class="qr-code"></div>
        </div>
    </div>
</body>
</html>